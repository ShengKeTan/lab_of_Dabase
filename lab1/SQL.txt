
--2.2
--(1)
/*
INSERT INTO lab2.dbo.FANS_3 SELECT * FROM [USER]
WHERE UID IN
	(SELECT UID
	 FROM FOLLOW
	 WHERE UIDFLED=3
	);
*/

--(5)
/*
CREATE TRIGGER thumbyourself
ON lab2.dbo.THUMB
FOR INSERT, UPDATE
AS
DECLARE @TUID INT
DECLARE @TBID INT
DECLARE @DUID INT
SELECT @TUID=UID FROM inserted
SELECT @TBID=BID FROM inserted
SELECT @DUID=UID FROM lab2.dbo.MBLOG WHERE BID=@TBID
IF @DUID=@TUID
BEGIN
RAISERROR('无法给自己点赞',10,1)
ROLLBACK TRANSACTION
END
*/
--DROP TRIGGER thumbyourself;
--INSERT INTO lab2.dbo.THUMB VALUES(2,4);

--2.3
--(1)
/*
SELECT * FROM lab2.dbo.[USER] 
WHERE lab2.dbo.[USER].UID IN (SELECT UIDFLED FROM lab2.dbo.FOLLOW WHERE UID IN
	(SELECT UID FROM lab2.dbo.[USER] WHERE NAME='若为君故呀'))
	ORDER BY BYEAR DESC, UID ASC;
*/
--(2)
/*
SELECT lab2.dbo.MBLOG.BID, lab2.dbo.MBLOG.TITLE, lab2.dbo.[USER].NAME
FROM lab2.dbo.[USER], lab2.dbo.MBLOG
WHERE lab2.dbo.[USER].UID=lab2.dbo.MBLOG.UID
AND lab2.dbo.MBLOG.BID NOT IN(SELECT BID FROM lab2.dbo.THUMB)
ORDER BY TITLE ASC;
*/
--(3)
/*
SELECT lab2.dbo.TOPDAY.BID FROM lab2.dbo.TOPDAY, lab2.dbo.MBLOG, lab2.dbo.[USER]
WHERE lab2.dbo.MBLOG.UID=lab2.dbo.[USER].UID
AND lab2.dbo.TOPDAY.BID=lab2.dbo.MBLOG.BID
AND lab2.dbo.[USER].BYEAR > 2000;
*/
--(4)
/*
SELECT UID FROM lab2.dbo.[USER]
WHERE NOT EXISTS
				(SELECT * FROM lab2.dbo.LABEL
				 WHERE NOT EXISTS
						        (SELECT * FROM lab2.dbo.SUB
								 WHERE lab2.dbo.SUB.LID=lab2.dbo.LABEL.LID
								 AND lab2.dbo.SUB.UID=lab2.dbo.[USER].UID
								)

				);
*/
/*
SELECT UID FROM lab2.dbo.SUB
GROUP BY UID HAVING COUNT(*)>(SELECT COUNT(*) FROM lab2.dbo.LABEL);
*/

--(5)
/*
SELECT UID, BYEAR, CITY FROM lab2.dbo.[USER]
WHERE BYEAR NOT BETWEEN 1970 AND 2010;
*/
--(6)
/*
SELECT CITY,COUNT(*) AS '次数' FROM lab2.dbo.[USER]
GROUP BY CITY;
*/
--(7)
/*
SELECT CITY, BYEAR, COUNT(*) AS '次数' FROM lab2.dbo.[USER]
GROUP BY CITY, BYEAR
ORDER BY CITY ASC, COUNT(*) DESC;
*/
--(8)
/*
SELECT BID, COUNT(*) AS '次数' FROM lab2.dbo.THUMB
GROUP BY BID HAVING COUNT(*)>10;
*/
--(9)
/*
SELECT BID, COUNT(*) AS '次数' FROM lab2.dbo.THUMB
WHERE BID IN (SELECT BID FROM [USER] WHERE BYEAR>2000)
GROUP BY BID HAVING COUNT(*)>10;
*/
--(10)
/*
SELECT BID, COUNT(*) AS '次数' FROM lab2.dbo.TOPDAY
WHERE BID IN (SELECT BID FROM [USER] WHERE BYEAR>2000)
GROUP BY BID HAVING COUNT(*)>10;
*/
--(11)
/*
SELECT lab2.dbo.SUB.UID, lab2.dbo.LABEL.LNAME FROM lab2.dbo.SUB, lab2.dbo.LABEL
WHERE lab2.dbo.SUB.LID=lab2.dbo.LABEL.LID
AND lab2.dbo.LABEL.LNAME IN('文学','艺术','哲学','音乐');
*/
--(12)
/*
SELECT * FROM lab2.dbo.MBLOG
WHERE TITLE LIKE'%最多地铁站%' 
AND TITLE LIKE'%\_华中科技大学%' ESCAPE'\';
*/
--(13)
/*
SELECT FIRST.UID, SECOND.UID AS FUID
FROM lab2.dbo.FOLLOW FIRST, lab2.dbo.FOLLOW SECOND
WHERE FIRST.UID=SECOND.UIDFLED
AND FIRST.UIDFLED=SECOND.UID
ORDER BY FIRST.UID;
*/
--(14)
/*
SELECT UID FROM lab2.dbo.FRIENDS F1
WHERE NOT EXISTS 
	  (SELECT * FROM lab2.dbo.FRIENDS F2
	   WHERE F2.UID=5 AND
		NOT EXISTS
		(SELECT * FROM lab2.dbo.FRIENDS F3
		 WHERE F3.UID=F1.UID AND
			   F3.FUID=F2.FUID
		)
	   )  
AND F1.UID!=5
GROUP BY F1.UID;
*/
--(15)
/*
SELECT lab2.dbo.MBLOG.BID, TITLE, lab2.dbo.B_L.LID 
FROM lab2.dbo.TOPDAY LEFT OUTER JOIN lab2.dbo.B_L
ON(lab2.dbo.TOPDAY.BID=lab2.dbo.B_L.BID), lab2.dbo.MBLOG
WHERE lab2.dbo.TOPDAY.BID=lab2.dbo.MBLOG.BID
AND lab2.dbo.TOPDAY.TYEAR=2019
AND lab2.dbo.TOPDAY.TMONTH=4
AND lab2.dbo.TOPDAY.TDAY=20;
*/
--(16)
/*
SELECT FIRST.UID, SECOND.UID AS FUID
FROM lab2.dbo.FRIENDS FIRST, lab2.dbo.FRIENDS SECOND
WHERE FIRST.FUID=SECOND.FUID
AND FIRST.UID!=SECOND.UID
GROUP BY FIRST.UID, SECOND.UID
HAVING COUNT(*)>3;
*/

--(17)
/*
CREATE VIEW HOTBLOG
AS
SELECT lab2.dbo.MBLOG.BID, TITLE, lab2.dbo.MBLOG.UID, NAME, COUNT(*) AS 'CI'
FROM lab2.dbo.MBLOG, lab2.dbo.[USER], lab2.dbo.THUMB
WHERE lab2.dbo.MBLOG.BID IN
		   (SELECT BID FROM lab2.dbo.TOPDAY 
		    WHERE TYEAR=YEAR(GETDATE())
			AND TMONTH=MONTH(GETDATE())
			AND TDAY=DAY(GETDATE())
            )
GROUP BY lab2.dbo.MBLOG.BID, TITLE, lab2.dbo.MBLOG.UID, NAME HAVING COUNT(*)>10;
*/



